%define _unpackaged_files_terminate_build 0
%define __os_install_post       /bin/true

Summary: eos project
Name: eos
Version: @VERSION@
Release: gcc@GCCVERSION@.9
Prefix: /opt/eos
License: none
Group: Applications/File
Source: @PACKAGE_TARNAME@-@PACKAGE_VERSION@.tar.gz
BuildRoot: %{_tmppath}/%{name}-root
#AutoReqProv: yes

Requires: xrootd-server-3.0.0

%description
eos project

%prep

# TODO: change this explicit path
%setup -n @PACKAGE_TARNAME@-@PACKAGE_VERSION@

%build
./bootstrap.sh
./configure --sysconfdir=/etc/ --with-xrootd=/usr/ --prefix=/opt/eos/
make -j 4


%install
make install DESTDIR=$RPM_BUILD_ROOT


%files
/opt/eos/bin/*
/opt/eos/lib/*
%config(noreplace) /etc/xrd.cf.fst
%config(noreplace) /etc/xrd.cf.mgm
%config(noreplace) /etc/xrd.cf.mq
%config(noreplace) /etc/xrd.cf.sync
%config(noreplace) /etc/sysconfig/xrd.example
%config(noreplace) /etc/sysconfig/eossync.example
%_sysconfdir/cron.d/xrd-logs
%_sysconfdir/cron.d/xrd-alive
%_sysconfdir/cron.d/eos-health
%_sysconfdir/rc.d/init.d/xrd
%_sysconfdir/rc.d/init.d/cmsd
%_sysconfdir/rc.d/init.d/eossync
%_sysconfdir/rc.d/init.d/eoshealth
%defattr(-,daemon,daemon,-)
%config(noreplace) /opt/eos/sss/eos-sss.keytab

%clean
rm -rf $RPM_BUILD_ROOT

%changelog

%post
mkdir -p -m 600 /var/eos
chown daemon.daemon /var/eos/
 